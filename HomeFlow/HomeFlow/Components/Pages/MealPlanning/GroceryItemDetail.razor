@page "/groceryitem"
@page "/groceryitem/{id:guid}"
@using HomeFlow.Components.Controls
@using HomeFlow.Extensions

<PageTitle>Grocery Item</PageTitle>

<MudContainer Fixed="true">
    @if ( GroceryItem == null )
    {
        <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="my-7" />
    }
    else
    {
        <MudForm Model="GroceryItem" @ref="@_form" Validation="@(validator.ValidateValue)" ValidationDelay="0">

            <MudPaper Class="pa-4">
                <MudText Typo="Typo.h6">Grocery Item</MudText>
                <MudGrid>
                    <MudItem sm="12" xs="12">
                        <MudTextField @bind-Value="GroceryItem.Name" For="@(() => GroceryItem.Name)" Label="Name" Variant="Variant.Outlined" />
                        <MudSelect @bind-Value="GroceryItem.GroceryItemType" For="@(() => GroceryItem.GroceryItemType)" Label="Type" Variant="Variant.Outlined">
                            @foreach ( GroceryItemType item in Enum.GetValues( typeof( GroceryItemType ) ) )
                            {
                                <MudSelectItem Value="@item">@item.ToString().SplitPascalCase()</MudSelectItem>
                            }
                        </MudSelect>
                    </MudItem>
                </MudGrid>
            </MudPaper>

            @if ( Id.HasValue )
            {
                <MudGrid>
                    <MudItem sm="12">
                        <MudPaper Class="pa-4 mt-4">
                            <MudStack Row>
                                <MudText Typo="Typo.h6">Used In</MudText>
                                <MudSpacer />
                                <MudButton Color="Color.Primary" Variant="Variant.Filled" Size="Size.Small" OnClick="OnExpandCollapseClick">@(_expanded ? "Collapse" : "Expand")</MudButton>
                            </MudStack>
                        
                            <MudDivider Class="mt-3 mb-2" />
                
                            <MudCollapse Expanded="_expanded">
                                <MudGrid>
                                    <MudItem sm="6">
                                        <MudTable Items="_recipes" T="Recipe" Striped Dense Hover Elevation="3" Class="ma-2" OnRowClick="NavigateToRecipe">
                                            <HeaderContent>
                                                <MudTh>Recipes</MudTh>
                                            </HeaderContent>
                                            <RowTemplate>
                                                <MudTd DataLabel="Recipe">@context.Name</MudTd>
                                            </RowTemplate>
                                            <NoRecordsContent>
                                                Not found in any recipes
                                            </NoRecordsContent>
                                        </MudTable>
                                    </MudItem>

                                    <MudItem sm="6">
                                        <MudTable Items="_groceryLists" T="GroceryList" Striped Dense Hover Elevation="3" Class="ma-2" OnRowClick="NavigateToGroceryList">
                                            <HeaderContent>
                                                <MudTh>Grocery Lists</MudTh>
                                            </HeaderContent>
                                            <RowTemplate>
                                                <MudTd DataLabel="GroceryList">@context.Name</MudTd>
                                            </RowTemplate>
                                            <NoRecordsContent>
                                                Not found in any grocery lists
                                            </NoRecordsContent>
                                        </MudTable>
                                    </MudItem>
                                </MudGrid>
                            </MudCollapse>
                        </MudPaper>
                    </MudItem>
                </MudGrid>
            }

            <MudPaper Class="pa-4 mt-4">
                <MudGrid>
                    <MudItem md="12" sm="12" xs="12">
                        <MudText Typo="Typo.h5">Tags</MudText>
                        <MudDivider />
                    </MudItem>
                    <MudItem md="12" xs="12">
                        <TagEditor Tags="GroceryItem.Tags" TagsChanged="OnTagsChanged" />
                    </MudItem>
                </MudGrid>
            </MudPaper>

            <MudPaper Class="pa-4 mt-4">
                <MudGrid>
                    <MudItem md="12" sm="12" xs="12">
                        <MudButton OnClick="Save" Variant="Variant.Filled" Color="Color.Primary">Save</MudButton>
                        <MudButton OnClick="Cancel" Variant="Variant.Text" Color="Color.Secondary">Cancel</MudButton>
                    </MudItem>
                </MudGrid>
            </MudPaper>
        </MudForm>

    }
</MudContainer>
